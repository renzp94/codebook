{"title":"Flutter常见问题","slug":"Flutter","time":"2021-06-23T18:24:00.000Z","author":"renzp94","status":"done","html":"<h2 id=\"问题-1-running-gradle-task-assembledebug长时间无反应-或者-could-not-determine-the-dependencies-of-task-appcompiledebugjavawithjavac\">问题 1: Running Gradle task &#39;assembleDebug&#39;...长时间无反应 或者 Could not determine the dependencies of task &#39;:app:compileDebugJavaWithJavac&#39;</h2>\n<p>此问题是因为<code>Google</code>被墙了,需要配置一下国内镜像,这里使用阿里云镜像.修改<code>android\\build.gradle</code>如下即可.此问题一般只会在搭建环境后第一次创建项目并运行,此后再创建项目则不会再出现此问题.</p>\n<p><code>android\\build.gradle</code></p>\n<pre><code class=\"language-diff\"><span class=\"hljs-keyword\">buildscript</span> {\n    ext.kotlin_version = <span class=\"hljs-string\">&#x27;1.3.50&#x27;</span>\n    repositories {\n-        google()\n-        jcenter()\n+        maven { url <span class=\"hljs-string\">&#x27;https://maven.aliyun.com/repository/google&#x27;</span> }\n+        <span class=\"hljs-keyword\">maven</span> { url <span class=\"hljs-string\">&#x27;https://maven.aliyun.com/repository/jcenter&#x27;</span> }\n+        <span class=\"hljs-keyword\">maven</span> { url <span class=\"hljs-string\">&#x27;http://maven.aliyun.com/nexus/content/groups/public&#x27;</span> }\n+        <span class=\"hljs-keyword\">maven</span> { url <span class=\"hljs-string\">&#x27;http://download.flutter.io&#x27;</span>}\n    }\n\n    <span class=\"hljs-keyword\">dependencies</span> {\n        classpath <span class=\"hljs-string\">&#x27;com.android.tools.build:gradle:4.1.0&#x27;</span>\n        classpath <span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-gradle-plugin:<span class=\"hljs-variable\">$kotlin_version</span>&quot;</span>\n    }\n}\n\n<span class=\"hljs-keyword\">allprojects</span> {\n    repositories {\n-        google()\n-        jcenter()\n+        maven { url <span class=\"hljs-string\">&#x27;https://maven.aliyun.com/repository/google&#x27;</span> }\n+        <span class=\"hljs-keyword\">maven</span> { url <span class=\"hljs-string\">&#x27;https://maven.aliyun.com/repository/jcenter&#x27;</span> }\n+        <span class=\"hljs-keyword\">maven</span> { url <span class=\"hljs-string\">&#x27;http://maven.aliyun.com/nexus/content/groups/public&#x27;</span> }\n+        <span class=\"hljs-keyword\">maven</span> { url <span class=\"hljs-string\">&#x27;http://download.flutter.io&#x27;</span>}\n    }\n}\n\nrootProject.buildDir = <span class=\"hljs-string\">&#x27;../build&#x27;</span>\n<span class=\"hljs-keyword\">subprojects</span> {\n    <span class=\"hljs-literal\">project</span>.buildDir = <span class=\"hljs-string\">&quot;${rootProject.buildDir}/${project.name}&quot;</span>\n}\n<span class=\"hljs-keyword\">subprojects</span> {\n    <span class=\"hljs-literal\">project</span>.evaluationDependsOn(<span class=\"hljs-string\">&#x27;:app&#x27;</span>)\n}\n\n<span class=\"hljs-keyword\">task</span> <span class=\"hljs-keyword\">clean</span>(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre>\n<h2 id=\"问题-2-build-tools2902-android-sdk-build-tools-2902\">问题 2: build-tools;29.0.2 Android SDK Build-Tools 29.0.2</h2>\n<pre><code>FAILURE: <span class=\"hljs-keyword\">Build</span> failed <span class=\"hljs-keyword\">with</span> an exception.\n\n* What went wrong:\nCould <span class=\"hljs-keyword\">not</span> determine the dependencies of task <span class=\"hljs-string\">&#x27;:app:compileDebugJavaWithJavac&#x27;</span>.\n&gt; Failed <span class=\"hljs-keyword\">to</span> install the following SDK components:\n      <span class=\"hljs-keyword\">build</span>-tools;29.0.2 Android SDK <span class=\"hljs-keyword\">Build</span>-Tools <span class=\"hljs-number\">29.0</span><span class=\"hljs-number\">.2</span>\n  Install the <span class=\"hljs-literal\">missing</span> components <span class=\"hljs-keyword\">using</span> the SDK manager <span class=\"hljs-keyword\">in</span> Android Studio.\n<span class=\"hljs-number\">2</span>\n\n* Try:\nRun <span class=\"hljs-keyword\">with</span> --stacktrace <span class=\"hljs-keyword\">option</span> <span class=\"hljs-keyword\">to</span> get the stack trace. Run <span class=\"hljs-keyword\">with</span> --info <span class=\"hljs-keyword\">or</span> --debug <span class=\"hljs-keyword\">option</span> <span class=\"hljs-keyword\">to</span> get more <span class=\"hljs-built_in\">log</span> output. Run <span class=\"hljs-keyword\">with</span> --scan <span class=\"hljs-keyword\">to</span> get full insights.\n\n* Get more help at https://help.gradle.org\n\n<span class=\"hljs-keyword\">BUILD</span> FAILED <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">4</span>s\nException: Gradle task assembleDebug failed <span class=\"hljs-keyword\">with</span> exit code <span class=\"hljs-number\">1</span>\n</code></pre>\n<p>此问题是因为 Flutter 打包使用的<code>Android SDK</code>和当前电脑上的不一致,通过<code>Flutter doctor</code>查看当前<code>Android SDK</code>的版本: <code>[√] Android toolchain - develop for Android devices (Android SDK version 30.0.3)</code>,然后在<code>android\\app\\build.gradle</code>文件中的<code>android</code>对象中添加<code>buildToolsVersion &quot;30.0.3&quot;</code>即可解决.</p>\n<p><code>android\\app\\build.gradle</code></p>\n<pre><code class=\"language-diff\"><span class=\"hljs-keyword\">def</span> localProperties = <span class=\"hljs-keyword\">new</span> Properties()\n<span class=\"hljs-keyword\">def</span> localPropertiesFile = rootProject.<span class=\"hljs-keyword\">file</span>(<span class=\"hljs-string\">&#x27;local.properties&#x27;</span>)\n<span class=\"hljs-keyword\">if</span> (localPropertiesFile.exists()) {\n    localPropertiesFile.<span class=\"hljs-keyword\">withReader</span>(<span class=\"hljs-string\">&#x27;UTF-8&#x27;</span>) { reader -&gt;\n        localProperties.load(reader)\n    }\n}\n\n<span class=\"hljs-keyword\">def</span> flutterRoot = localProperties.getProperty(<span class=\"hljs-string\">&#x27;flutter.sdk&#x27;</span>)\n<span class=\"hljs-keyword\">if</span> (flutterRoot == <span class=\"hljs-keyword\">null</span>) {\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> GradleException(<span class=\"hljs-string\">&quot;Flutter SDK not found. Define location with flutter.sdk in the local.properties file.&quot;</span>)\n}\n\n<span class=\"hljs-keyword\">def</span> flutterVersionCode = localProperties.getProperty(<span class=\"hljs-string\">&#x27;flutter.versionCode&#x27;</span>)\n<span class=\"hljs-keyword\">if</span> (flutterVersionCode == <span class=\"hljs-keyword\">null</span>) {\n    flutterVersionCode = <span class=\"hljs-string\">&#x27;1&#x27;</span>\n}\n\n<span class=\"hljs-keyword\">def</span> flutterVersionName = localProperties.getProperty(<span class=\"hljs-string\">&#x27;flutter.versionName&#x27;</span>)\n<span class=\"hljs-keyword\">if</span> (flutterVersionName == <span class=\"hljs-keyword\">null</span>) {\n    flutterVersionName = <span class=\"hljs-string\">&#x27;1.0&#x27;</span>\n}\n\napply plugin: <span class=\"hljs-string\">&#x27;com.android.application&#x27;</span>\napply plugin: <span class=\"hljs-string\">&#x27;kotlin-android&#x27;</span>\napply <span class=\"hljs-keyword\">from</span>: <span class=\"hljs-string\">&quot;$flutterRoot/packages/flutter_tools/gradle/flutter.gradle&quot;</span>\n\nandroid {\n    compileSdkVersion <span class=\"hljs-number\">30</span>\n+    buildToolsVersion <span class=\"hljs-string\">&quot;30.0.3&quot;</span>\n\n    <span class=\"hljs-keyword\">sourceSets</span> {\n        main.java.srcDirs += <span class=\"hljs-string\">&#x27;src/main/kotlin&#x27;</span>\n    }\n\n    defaultConfig {\n        <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">TODO:</span> Specify your own unique Application ID (https://developer.android.com/studio/build/application-id.html).</span>\n        applicationId <span class=\"hljs-string\">&quot;com.example.learn&quot;</span>\n        minSdkVersion <span class=\"hljs-number\">16</span>\n        targetSdkVersion <span class=\"hljs-number\">30</span>\n        versionCode flutterVersionCode.<span class=\"hljs-keyword\">toInteger</span>()\n        versionName flutterVersionName\n    }\n\n    buildTypes {\n        release {\n            <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">TODO:</span> Add your own signing config for the release build.</span>\n            <span class=\"hljs-comment\">// Signing with the debug keys for now, so `flutter run --release` works.</span>\n            signingConfig signingConfigs.debug\n        }\n    }\n}\n\nflutter {\n    <span class=\"hljs-keyword\">source</span> <span class=\"hljs-string\">&#x27;../..&#x27;</span>\n}\n\n<span class=\"hljs-keyword\">dependencies</span> {\n    implementation <span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version&quot;</span>\n}\n</code></pre>\n"}