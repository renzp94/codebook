<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#333333" />
		<link rel="stylesheet" href="/assets/styles/global.css" />
		<title>React状态管理：Recoil指南</title>

		

		<link rel="modulepreload" href="/./_app/start-97f7b82c.js">
		<link rel="modulepreload" href="/./_app/chunks/vendor-d00531f1.js">
		<link rel="modulepreload" href="/./_app/pages/__layout.svelte-b0488dc3.js">
		<link rel="modulepreload" href="/./_app/pages/article/__layout.svelte-9a26e2ca.js">
		<link rel="modulepreload" href="/./_app/pages/article/[category]/[id].svelte-35c0c78b.js">
		<link rel="modulepreload" href="/./_app/chunks/utils-a81d5505.js">
		<link rel="stylesheet" href="/./_app/assets/start-a8cd1609.css">
		<link rel="stylesheet" href="/./_app/assets/pages/__layout.svelte-dfbf40bb.css">
		<link rel="stylesheet" href="/./_app/assets/pages/article/__layout.svelte-1448dd73.css">
		<link rel="stylesheet" href="/./_app/assets/pages/article/[category]/[id].svelte-7f79f039.css">

		<script type="module">
			import { start } from "/./_app/start-97f7b82c.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":"/."},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/./_app/pages/__layout.svelte-b0488dc3.js"),
						import("/./_app/pages/article/__layout.svelte-9a26e2ca.js"),
						import("/./_app/pages/article/[category]/[id].svelte-35c0c78b.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/article/react/20210812215625",
						query: new URLSearchParams(""),
						params: {"category":"react","id":"20210812215625"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">



<section class="svelte-jbk32v"><header class="svelte-jbk32v"><a href="/"><img class="logo svelte-jbk32v" src="/assets/images/logo.png" alt="code book logo"></a>
<a class="github svelte-jbk32v" href="https://github.com/renzp94" target="_blank"><i class="iconfont icon-github svelte-jbk32v"></i></a></header>
	<main><section><main class="svelte-1fbldbu">

<section class="md"><h1 class="title">React状态管理：Recoil指南</h1>
  <div class="info svelte-1vg5uky"><div class="author svelte-1vg5uky">作者：renzp94</div>
    <div class="time">时间：2021-08-12 21:57:20</div></div>

  <div class="md-content"><h2 id="recoilroot">RecoilRoot</h2>
<p>提供上下文。此组件必须是所有使用<code>Recoil hook</code>组件的根组件</p>
<ul>
<li><code>initializeState</code>：可使用<code>MutableSnapshot</code>初始化<code>atom</code>状态，可选函数(<code>({set,setUnvalidatedAtomValues}) =&gt; void</code>)</li>
<li><code>override</code>：是否重新创建新的<code>Recoil</code>作用域，默认为<code>true</code>。一般用于多个<code>&lt;RecoilRoot&gt;</code>嵌套，当为<code>true</code>时会重新创建一个<code>Recoil</code>作用域，新的作用域会覆盖上级<code>&lt;RecoilRoot&gt;</code>中同名。为<code>false</code>则只渲染子组件，没有其他作用</li>
</ul>
<p>通常情况下,<code>atom</code>或<code>selector</code>需要配合以下<code>hook</code>使用: <code>useRecoilState(读写)</code>,<code>useRecoilValue(只读)</code>,<code>useSetRecoilState(只写)</code>,<code>useResetRecoilState(重置)</code>,现在只需要了解,这些<code>hook</code>后续会讲解</p>
<h2 id="atom">atom()</h2>
<p>一个<code>atom</code>表示<code>Recoil</code>的<code>state</code>,接收一个对象,返回一个可写的<code>RecoilState</code>对象.接收对象属性如下:</p>
<ul>
<li><code>key</code>：标识当前<code>atom</code>的唯一<code>key</code>值，请记住：<code>key</code>需要保持全局唯一</li>
<li><code>default</code>：默认值,可是任意类型的值,也可以是<code>RecoilState(atom或selector)</code>,也可以是一个异步函数</li>
<li><code>dangerouslyAllowMutability</code>：设置允许<code>atom</code>中的对象可变，对象变化不代表<code>status</code>的变化</li>
</ul>
<p><code>Recoil</code>管理<code>atom</code>的<code>state</code>的变化,并通知订阅该<code>atom</code>的组件何时渲染</p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { atom, RecoilRoot, useRecoilState, useRecoilValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> countState = atom({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;countState&#x27;</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
});

<span class="hljs-keyword">const</span> Count = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> count = useRecoilValue(countState);
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
};

<span class="hljs-keyword">const</span> CountButton = <span class="hljs-function">(<span class="hljs-params">props: { <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [count, setCount] = useRecoilState(countState);
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + (props.type === &#x27;add&#x27; ? 1 : -1))}&gt;
            {props.type === &#x27;add&#x27; ? &#x27;+&#x27; : &#x27;-&#x27;}
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">CountButton</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;dec&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Count</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">CountButton</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;add&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<p>如果需要在不订阅组件的情况下读取<code>atom</code>的值,可使用<code>useRecoilCallback</code>.如果需要基于上一个值更新的话,可以向<code>set</code>函数传入一个函数,函数的参数就是最新的值,返回一个需要设置的值.
<br />
当<code>default</code>传入是一个函数时，则在使用<code>hook</code>返回的值也是一个函数.</p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { atom, RecoilRoot, useRecoilValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> msgState = atom({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;msg&#x27;</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">&#x27;Hello&#x27;</span>
});

<span class="hljs-keyword">const</span> Msg = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> msg = useRecoilValue(msgState);
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{msg()}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Msg</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<br />

<p>切记<code>default</code>不能传入一个异步函数，如果需要异步获取数据，可以使用<code>selector</code>包装一下，但一般如果需要异步请求的话，建议放在<code>selector</code>中</p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React, { Suspense } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { atom, RecoilRoot, selector, useRecoilValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> msgState = atom({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;msg&#x27;</span>,
    <span class="hljs-attr">default</span>: selector({
        <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;msgSelector&#x27;</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">async</span> () =&gt; {
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> resolve(<span class="hljs-string">&#x27;Hello&#x27;</span>), <span class="hljs-number">2000</span>);
            });

            <span class="hljs-keyword">return</span> data;
        }
    })
});

<span class="hljs-keyword">const</span> Msg = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> msg = useRecoilValue(msgState);
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{msg}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">Msg</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<h2 id="selector">selector()</h2>
<p><code>selector</code>是一个纯函数，是派生状态，可基于<code>atom</code>或<code>selector</code>返回处理过的状态，类似<code>Vue</code>中的<code>compoted</code>。接收一个对象,对象属性如下：</p>
<ul>
<li><code>get</code>：一个处理<code>state</code>的函数，返回处理过的值，也可返回一个异步的<code>Promise</code>或相同类型的<code>atom</code>或<code>selector</code>。函数的参数是一个对象：<ul>
<li><code>get</code>：用来获取其他的<code>atom</code>或<code>selector</code>值的函数，所有传入此函数的<code>atom</code>或<code>selector</code>会被隐式的添加到此<code>selector</code>的依赖列表中，当依赖发生改变时，则会重新计算</li>
<li><code>getCallback</code>：用于创建<code>Recoil-aware</code>回调的函数</li>
</ul>
</li>
<li><code>set</code>：若设置了该属性，则<code>selector</code>会返回一个可写的<code>state</code>，当改变<code>selector</code>则会调用此函数。此函数接收两个参数,第一个参数是一个对象，第二个参数是一个新值，第一个参数对象属性如下：<ul>
<li><code>get</code>：用来获取其他的<code>atom</code>或<code>selector</code>值的函数</li>
<li><code>set</code>：用来设置<code>Recoil</code>状态的函数，第一个参数是<code>Recoil</code>的<code>state</code>，第二个参数是新的值，新值可以是一个更新函数或一个<code>DefaultVaue</code>类型的对象</li>
</ul>
</li>
<li><code>dangerouslyAllowMutability</code>：设置允许<code>atom</code>中的对象可变，对象变化不代表<code>status</code>的变化</li>
</ul>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { atom, RecoilRoot, selector, useRecoilState, useRecoilValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> firstNameState = atom({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;firstName&#x27;</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;Code&#x27;</span>
});

<span class="hljs-keyword">const</span> lastNameState = atom({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;lastName&#x27;</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;Book&#x27;</span>
});

<span class="hljs-keyword">const</span> fullNameSelector = selector&lt;<span class="hljs-built_in">string</span>&gt;({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;fullName&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">{ get }</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${get(firstNameState)}</span>-<span class="hljs-subst">${get(lastNameState) ?? <span class="hljs-string">&#x27;&#x27;</span>}</span>`</span>,
    <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">{ set }, value</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> [firstName, lastName] = value.split(<span class="hljs-string">&#x27;-&#x27;</span>);
        set(firstNameState, firstName);
        set(lastNameState, lastName);
    }
});

<span class="hljs-keyword">const</span> UpperFullNameSelector = selector&lt;<span class="hljs-built_in">string</span>&gt;({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;upperFullName&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">{ get }</span>) =&gt;</span> get(fullNameSelector).toUpperCase()
});

<span class="hljs-keyword">const</span> Name = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> [firstName, setFirstName] = useRecoilState(firstNameState);
    <span class="hljs-keyword">const</span> [lastName, setLastName] = useRecoilState(lastNameState);
    <span class="hljs-keyword">const</span> [fullName, setFullName] = useRecoilState(fullNameSelector);
    <span class="hljs-keyword">const</span> upperFullName = useRecoilValue(UpperFullNameSelector);

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>firstName：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{firstName}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setFirstName(e.target.value)} /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>lastName：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{lastName}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setLastName(e.target.value)} /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>fullName：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{fullName}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setFullName(e.target.value)} /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{upperFullName}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    );
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Name</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<p><code>selector</code>还支持异步,由于<code>React</code>的渲染函数是同步的，所以需要<code>Suspense</code>边界包裹组件，需要捕获错误，可用<code>ErrorBoundary</code>包裹,如果需要查询时传入参数，可使用<code>selectorFamily</code></p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React, { Suspense } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { atom, RecoilRoot, selector, selectorFamily, useRecoilValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-comment">// const userIdState = atom({</span>
<span class="hljs-comment">//     key:&#x27;userId&#x27;,</span>
<span class="hljs-comment">//     default: 1</span>
<span class="hljs-comment">// })</span>

<span class="hljs-comment">// const userInfoSelector = selector({</span>
<span class="hljs-comment">//     key:&#x27;userInfo&#x27;,</span>
<span class="hljs-comment">//     get: async ({get}) =&gt; {</span>
<span class="hljs-comment">//         const data = await new Promise(resolve =&gt; {</span>
<span class="hljs-comment">//             setTimeout(()=&gt; resolve({id:get(userIdState),name:&#x27;用户001&#x27;}),2000)</span>
<span class="hljs-comment">//         })</span>

<span class="hljs-comment">//         return data</span>
<span class="hljs-comment">//     }</span>
<span class="hljs-comment">// })</span>

<span class="hljs-keyword">const</span> userInfoSelector = selectorFamily({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;userInfo&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> resolve({ id, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;用户001&#x27;</span> }), <span class="hljs-number">2000</span>);
        });

        <span class="hljs-keyword">return</span> data;
    }
});

<span class="hljs-keyword">const</span> AsyncSelector = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> userInfo = useRecoilValue(userInfoSelector(<span class="hljs-number">1</span>));

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>用户id:{userInfo.id}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>用户名:{userInfo.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    );
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">AsyncSelector</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<p>如果需要并行请求数据可以使用<code>waitForAll</code>一次并行请求多条接口，也可以通过<code>waiForOne</code>实现增量请求更新。
一般数据会在渲染之前请求获取，在<code>Recoil</code>中可以使用<code>useRecoilCallback</code></p>
<h2 id="userecoilstate">useRecoilState()</h2>
<blockquote>
<p>对<code>Recoil state</code>读写，返回一个数组，数组第一个元素是<code>state</code>当前值，第二个元素是设置<code>state</code>值的函数。</p>
</blockquote>
<h2 id="userecoilvalue">useRecoilValue()</h2>
<blockquote>
<p>读取<code>Recoil state</code>的值，返回<code>state</code>的当前值。</p>
</blockquote>
<h2 id="usesetrecoilstate">useSetRecoilState()</h2>
<blockquote>
<p>设置<code>Recoil state</code></p>
</blockquote>
<h2 id="useresetrecoilstate">useResetRecoilState()</h2>
<blockquote>
<p>重置<code>Recoil state</code></p>
</blockquote>
<h2 id="userecoilstateloadable">useRecoilStateLoadable()</h2>
<blockquote>
<p>读写异步<code>selector</code>的值。返回一个数组，数组第一个元素是<code>Loadable</code>，第二个元素是设置的函数。使用此<code>hooks</code>可以不使用<code>Suspense</code>来使用异步<code>selector</code></p>
</blockquote>
<p><code>Loadable</code>属性：</p>
<ul>
<li><code>state</code>：<code>selector</code>所处状态</li>
<li><code>hasValue</code>：成功</li>
<li><code>loading</code>：请求中</li>
<li><code>hasError</code>：失败</li>
<li><code>contents</code>：当前表示的值，<code>hasValue</code>状态时表示实际值，<code>loading</code>时表示<code>Promise</code>，<code>hasError</code>时表示<code>Error</code>对象</li>
</ul>
<h2 id="userecoilvalueloadable">useRecoilValueLoadable()</h2>
<blockquote>
<p>仅获取异步<code>selector</code>的值。返回的是一个<code>Loadable</code>，同<code>useRecoilStateLoadable</code></p>
</blockquote>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React, { Suspense } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { RecoilRoot, selectorFamily, useRecoilValue, useRecoilValueLoadable } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> userInfoSelector = selectorFamily({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;userInfo&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> resolve({ id, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;用户001&#x27;</span> }), <span class="hljs-number">2000</span>);
        });

        <span class="hljs-keyword">return</span> data;
    }
});

<span class="hljs-keyword">const</span> AsyncSelector = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> userInfo = useRecoilValueLoadable(userInfoSelector(<span class="hljs-number">1</span>));

    <span class="hljs-keyword">switch</span> (userInfo.state) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;hasValue&#x27;</span>:
            <span class="hljs-keyword">return</span> (
                <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>用户id:{userInfo.contents.id}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>用户名:{userInfo.contents.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/&gt;</span></span>
            );
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;loading&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;hasError&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>error<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
    }
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">AsyncSelector</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<h2 id="isrecoilvalue">isRecoilValue()</h2>
<blockquote>
<p>是否为<code>atom</code>或<code>selector</code></p>
</blockquote>
<h2 id="atomfamily">atomFamily()</h2>
<p>返回一个返回可写的<code>RecoilState atom</code>函数，用于表示一个<code>atom</code>的集合。当你需要给<code>atom</code>传参数时，可以使用此函数。</p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { atomFamily, RecoilRoot, useRecoilValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> msgState = atomFamily({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;msg&#x27;</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> msg.toUpperCase()
});

<span class="hljs-keyword">const</span> Msg = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> msg = useRecoilValue(msgState(<span class="hljs-string">&#x27;hello&#x27;</span>));
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{msg}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Msg</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<h2 id="selectorfamily">selectorFamily()</h2>
<p>返回一个函数，该函数返回一个只读的<code>RecoilValueReadOnly</code>或者可写的<code>RecoilState selector</code>。当你需要给<code>selector</code>传参数时，可以使用此函数</p>
<h2 id="constselector">constSelector()</h2>
<p>一个永远提供常量值的<code>selector</code>。(不太清楚有什么用)</p>
<h2 id="errorselector">errorSelector()</h2>
<p>一个总是抛出已有错误的<code>selector</code>。(不太清楚有什么用)</p>
<h2 id="nowait">noWait()</h2>
<p><code>select helper</code>方法，返回值代表所提供的<code>atom</code> 或<code>selector</code>当前状态的<code>Loadable</code>，与<code>useRecoilValueLoadable()</code>类似，但<code>noWait</code>是一个<code>selector</code>不是钩子函数</p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { noWait, RecoilRoot, selector, useRecoilValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> msgSelector = selector({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;msgSelector&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> resolve(<span class="hljs-string">&#x27;Hello&#x27;</span>), <span class="hljs-number">2000</span>);
        });

        <span class="hljs-keyword">return</span> data;
    }
});

<span class="hljs-keyword">const</span> Msg = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> msgLoadable = useRecoilValue(noWait(msgSelector));

    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">hasValue</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{msgLoadable.contents}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
        loading: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
        hasError: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>erro:{msgLoadable.contents}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    }[msgLoadable.state];
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Msg</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<h2 id="waitfroall">waitFroAll()</h2>
<p>并发计算多个异步依赖项的并发<code>helper</code>方法，即：可用于并发请求数据。接收一个数组或者对象。</p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { RecoilRoot, selector, useRecoilValueLoadable, waitForAll } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> userSelector = selector({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;userSelector&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;user start&#x27;</span>);
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> resolve({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;codebook&#x27;</span> }), <span class="hljs-number">2000</span>)
        );
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;user end&#x27;</span>);
        <span class="hljs-keyword">return</span> data;
    }
});

<span class="hljs-keyword">const</span> listSelector = selector({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;listSelector&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;list start&#x27;</span>);
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> resolve([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]), <span class="hljs-number">2500</span>));
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;list end&#x27;</span>);
        <span class="hljs-keyword">return</span> data;
    }
});

<span class="hljs-keyword">const</span> Msg = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { state, contents } = useRecoilValueLoadable(waitForAll([userSelector, listSelector]));

    <span class="hljs-keyword">switch</span> (state) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;hasValue&#x27;</span>:
            <span class="hljs-keyword">const</span> [user, list] = contents;
            <span class="hljs-keyword">return</span> (
                <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>用户名：{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>列表数据：<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    {list.map((item) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item}</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    ))}
                <span class="hljs-tag">&lt;/&gt;</span></span>
            );
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;loading&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;hasError&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>error: {contents}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
    }
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Msg</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<h2 id="waitforallsettled">waitForAllSettled</h2>
<p>并发计算多个异步依赖项的并发<code>helper</code>方法，即：可用于并发请求数据。接收一个数组或者对象。一直等待，直到有一个成功返回。</p>
<pre><code class="language-tsx"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { RecoilRoot, selector, useRecoilValueLoadable, waitForAllSettled } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;

<span class="hljs-keyword">const</span> userSelector = selector({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;userSelector&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;user start&#x27;</span>);
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> resolve({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;codebook&#x27;</span> }), <span class="hljs-number">2000</span>)
        );
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;user end&#x27;</span>);
        <span class="hljs-keyword">return</span> data;
    }
});

<span class="hljs-keyword">const</span> listSelector = selector({
    <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;listSelector&#x27;</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;list start&#x27;</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(reject, <span class="hljs-number">3000</span>));
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;list end&#x27;</span>);
        }
    }
});

<span class="hljs-keyword">const</span> Msg = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { state, contents } = useRecoilValueLoadable(
        waitForAllSettled([userSelector, listSelector])
    );

    <span class="hljs-keyword">switch</span> (state) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;hasValue&#x27;</span>:
            <span class="hljs-keyword">const</span> [{ <span class="hljs-attr">contents</span>: user }, { <span class="hljs-attr">contents</span>: list }] = contents; <span class="hljs-comment">// =&gt; user: {id:1,name:&#x27;codebook} list: undefined</span>
            <span class="hljs-keyword">return</span> (
                <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>用户名：{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>列表数据：<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    {list?.map((item) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item}</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    ))}
                <span class="hljs-tag">&lt;/&gt;</span></span>
            );
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;loading&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;hasError&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>error: {contents}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
    }
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RecoilRoot</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Msg</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RecoilRoot</span>&gt;</span></span>
    );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</code></pre>
<h2 id="waitfornone">waitForNone()</h2>
<p>并发计算多个异步依赖项的并发<code>helper</code>方法，即：可用于并发请求数据。接收一个数组或者对象。与<code>waitForAll</code>类似，区别在于<code>waitForNone</code>会立即为每个依赖返回一个<code>Loadable</code>，而不是直接返回值</p>
<h2 id="waitforany">waitForAny()</h2>
<p>并发计算多个异步依赖项的并发<code>helper</code>方法，即：可用于并发请求数据。接收一个数组或者对象。一直等待，直到有一个成功返回</p>
<h2 id="userecoilcallback">useRecoilCallback</h2>
<p>类似<code>useCallback</code>,这个回调可以访问<code>Recoil</code>状态的只读<code>Snapshot</code>，并且能够异步更新当前的<code>Recoil</code>状态。使用场景：</p>
<ul>
<li>异步读取<code>Recoil</code>状态，而无需订阅<code>React</code>组件在<code>atom</code>或<code>selector</code>更新时重新渲染</li>
<li>把昂贵的查询延迟到一个你不想在渲染时执行的异步操作</li>
<li>在你想读取 或写入<code>Recoil</code>状态的地方执行副作用</li>
<li>动态更新一个<code>atom</code>或<code>selector</code>，可能并不知道在渲染时要更新哪个<code>atom</code>或<code>selector</code>，所以不能使用<code>useRecoilState()</code></li>
<li><code>Pre-fetching</code>渲染前的数据</li>
</ul>
<p>接收参数和<code>useCallback</code>一样，包括传入空数组只在初始化后执行一次，传入依赖项，当依赖项发生变化，重新执行。
<br /></p>
<p>回调函数的参数：</p>
<ul>
<li><code>snapshot</code>：<code>Snapshot</code>提供一个只读的<code>Recoil atom</code>状态</li>
<li><code>gotoSnapshot</code>：更新全局状态以匹配提供的<code>Snapshot</code></li>
<li><code>set</code>：设置<code>atom</code>或<code>selector</code>的值</li>
<li><code>reset</code>：重置<code>atom</code>或<code>selector</code>的值</li>
</ul>
</div>
</section></main>
</section></main>
	
<div class="back-top svelte-9c9s8u" style="bottom: 5rem;right: 0.625rem;display: none"><i class="iconfont icon-back-top"></i>
</div>
</section>



	<script type="svelte-data" url="20210812215625.json">{"status":200,"statusText":"","headers":{"content-type":"text/plain;charset=UTF-8"},"body":"{\"title\":\"React状态管理：Recoil指南\",\"slug\":\"react store\",\"time\":\"2021-08-12T21:57:20.000Z\",\"author\":\"renzp94\",\"status\":\"done\",\"html\":\"\u003Ch2 id=\\\"recoilroot\\\"\u003ERecoilRoot\u003C\u002Fh2\u003E\\n\u003Cp\u003E提供上下文。此组件必须是所有使用\u003Ccode\u003ERecoil hook\u003C\u002Fcode\u003E组件的根组件\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ccode\u003EinitializeState\u003C\u002Fcode\u003E：可使用\u003Ccode\u003EMutableSnapshot\u003C\u002Fcode\u003E初始化\u003Ccode\u003Eatom\u003C\u002Fcode\u003E状态，可选函数(\u003Ccode\u003E({set,setUnvalidatedAtomValues}) =&gt; void\u003C\u002Fcode\u003E)\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Eoverride\u003C\u002Fcode\u003E：是否重新创建新的\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E作用域，默认为\u003Ccode\u003Etrue\u003C\u002Fcode\u003E。一般用于多个\u003Ccode\u003E&lt;RecoilRoot&gt;\u003C\u002Fcode\u003E嵌套，当为\u003Ccode\u003Etrue\u003C\u002Fcode\u003E时会重新创建一个\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E作用域，新的作用域会覆盖上级\u003Ccode\u003E&lt;RecoilRoot&gt;\u003C\u002Fcode\u003E中同名。为\u003Ccode\u003Efalse\u003C\u002Fcode\u003E则只渲染子组件，没有其他作用\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E通常情况下,\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E需要配合以下\u003Ccode\u003Ehook\u003C\u002Fcode\u003E使用: \u003Ccode\u003EuseRecoilState(读写)\u003C\u002Fcode\u003E,\u003Ccode\u003EuseRecoilValue(只读)\u003C\u002Fcode\u003E,\u003Ccode\u003EuseSetRecoilState(只写)\u003C\u002Fcode\u003E,\u003Ccode\u003EuseResetRecoilState(重置)\u003C\u002Fcode\u003E,现在只需要了解,这些\u003Ccode\u003Ehook\u003C\u002Fcode\u003E后续会讲解\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"atom\\\"\u003Eatom()\u003C\u002Fh2\u003E\\n\u003Cp\u003E一个\u003Ccode\u003Eatom\u003C\u002Fcode\u003E表示\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E的\u003Ccode\u003Estate\u003C\u002Fcode\u003E,接收一个对象,返回一个可写的\u003Ccode\u003ERecoilState\u003C\u002Fcode\u003E对象.接收对象属性如下:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ccode\u003Ekey\u003C\u002Fcode\u003E：标识当前\u003Ccode\u003Eatom\u003C\u002Fcode\u003E的唯一\u003Ccode\u003Ekey\u003C\u002Fcode\u003E值，请记住：\u003Ccode\u003Ekey\u003C\u002Fcode\u003E需要保持全局唯一\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Edefault\u003C\u002Fcode\u003E：默认值,可是任意类型的值,也可以是\u003Ccode\u003ERecoilState(atom或selector)\u003C\u002Fcode\u003E,也可以是一个异步函数\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003EdangerouslyAllowMutability\u003C\u002Fcode\u003E：设置允许\u003Ccode\u003Eatom\u003C\u002Fcode\u003E中的对象可变，对象变化不代表\u003Ccode\u003Estatus\u003C\u002Fcode\u003E的变化\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E管理\u003Ccode\u003Eatom\u003C\u002Fcode\u003E的\u003Ccode\u003Estate\u003C\u002Fcode\u003E的变化,并通知订阅该\u003Ccode\u003Eatom\u003C\u002Fcode\u003E的组件何时渲染\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { atom, RecoilRoot, useRecoilState, useRecoilValue } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E countState = atom({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;countState&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Edefault\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Count = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E count = useRecoilValue(countState);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{count}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E CountButton = \u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eprops: { \u003Cspan class=\\\"hljs-keyword\\\"\u003Etype\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-built_in\\\"\u003Estring\u003C\u002Fspan\u003E }\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E [count, setCount] = useRecoilState(countState);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003EonClick\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{()\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E setCount(count + (props.type === &#x27;add&#x27; ? 1 : -1))}&gt;\\n            {props.type === &#x27;add&#x27; ? &#x27;+&#x27; : &#x27;-&#x27;}\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ECountButton\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Etype\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;dec&quot;\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ECount\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ECountButton\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Etype\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;add&quot;\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E如果需要在不订阅组件的情况下读取\u003Ccode\u003Eatom\u003C\u002Fcode\u003E的值,可使用\u003Ccode\u003EuseRecoilCallback\u003C\u002Fcode\u003E.如果需要基于上一个值更新的话,可以向\u003Ccode\u003Eset\u003C\u002Fcode\u003E函数传入一个函数,函数的参数就是最新的值,返回一个需要设置的值.\\n\u003Cbr \u002F\u003E\\n当\u003Ccode\u003Edefault\u003C\u002Fcode\u003E传入是一个函数时，则在使用\u003Ccode\u003Ehook\u003C\u002Fcode\u003E返回的值也是一个函数.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { atom, RecoilRoot, useRecoilValue } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msgState = atom({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;msg&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Edefault\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Hello&#x27;\u003C\u002Fspan\u003E\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Msg = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msg = useRecoilValue(msgState);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{msg()}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EMsg\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cbr \u002F\u003E\\n\\n\u003Cp\u003E切记\u003Ccode\u003Edefault\u003C\u002Fcode\u003E不能传入一个异步函数，如果需要异步获取数据，可以使用\u003Ccode\u003Eselector\u003C\u002Fcode\u003E包装一下，但一般如果需要异步请求的话，建议放在\u003Ccode\u003Eselector\u003C\u002Fcode\u003E中\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React, { Suspense } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { atom, RecoilRoot, selector, useRecoilValue } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msgState = atom({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;msg&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Edefault\u003C\u002Fspan\u003E: selector({\\n        \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;msgSelector&#x27;\u003C\u002Fspan\u003E,\\n        \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\\n                \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E resolve(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Hello&#x27;\u003C\u002Fspan\u003E), \u003Cspan class=\\\"hljs-number\\\"\u003E2000\u003C\u002Fspan\u003E);\\n            });\\n\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n        }\\n    })\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Msg = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msg = useRecoilValue(msgState);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{msg}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ESuspense\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Efallback\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{\u003C\u002Fspan\u003E&lt;\u003Cspan class=\\\"hljs-attr\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eloading...\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E}&gt;\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EMsg\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ESuspense\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2 id=\\\"selector\\\"\u003Eselector()\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ccode\u003Eselector\u003C\u002Fcode\u003E是一个纯函数，是派生状态，可基于\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E返回处理过的状态，类似\u003Ccode\u003EVue\u003C\u002Fcode\u003E中的\u003Ccode\u003Ecompoted\u003C\u002Fcode\u003E。接收一个对象,对象属性如下：\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ccode\u003Eget\u003C\u002Fcode\u003E：一个处理\u003Ccode\u003Estate\u003C\u002Fcode\u003E的函数，返回处理过的值，也可返回一个异步的\u003Ccode\u003EPromise\u003C\u002Fcode\u003E或相同类型的\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E。函数的参数是一个对象：\u003Cul\u003E\\n\u003Cli\u003E\u003Ccode\u003Eget\u003C\u002Fcode\u003E：用来获取其他的\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E值的函数，所有传入此函数的\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E会被隐式的添加到此\u003Ccode\u003Eselector\u003C\u002Fcode\u003E的依赖列表中，当依赖发生改变时，则会重新计算\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003EgetCallback\u003C\u002Fcode\u003E：用于创建\u003Ccode\u003ERecoil-aware\u003C\u002Fcode\u003E回调的函数\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Eset\u003C\u002Fcode\u003E：若设置了该属性，则\u003Ccode\u003Eselector\u003C\u002Fcode\u003E会返回一个可写的\u003Ccode\u003Estate\u003C\u002Fcode\u003E，当改变\u003Ccode\u003Eselector\u003C\u002Fcode\u003E则会调用此函数。此函数接收两个参数,第一个参数是一个对象，第二个参数是一个新值，第一个参数对象属性如下：\u003Cul\u003E\\n\u003Cli\u003E\u003Ccode\u003Eget\u003C\u002Fcode\u003E：用来获取其他的\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E值的函数\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Eset\u003C\u002Fcode\u003E：用来设置\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E状态的函数，第一个参数是\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E的\u003Ccode\u003Estate\u003C\u002Fcode\u003E，第二个参数是新的值，新值可以是一个更新函数或一个\u003Ccode\u003EDefaultVaue\u003C\u002Fcode\u003E类型的对象\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003EdangerouslyAllowMutability\u003C\u002Fcode\u003E：设置允许\u003Ccode\u003Eatom\u003C\u002Fcode\u003E中的对象可变，对象变化不代表\u003Ccode\u003Estatus\u003C\u002Fcode\u003E的变化\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { atom, RecoilRoot, selector, useRecoilState, useRecoilValue } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E firstNameState = atom({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;firstName&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Edefault\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Code&#x27;\u003C\u002Fspan\u003E\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E lastNameState = atom({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;lastName&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Edefault\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Book&#x27;\u003C\u002Fspan\u003E\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E fullNameSelector = selector&lt;\u003Cspan class=\\\"hljs-built_in\\\"\u003Estring\u003C\u002Fspan\u003E&gt;({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;fullName&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003E{ get }\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E`\u003Cspan class=\\\"hljs-subst\\\"\u003E${get(firstNameState)}\u003C\u002Fspan\u003E-\u003Cspan class=\\\"hljs-subst\\\"\u003E${get(lastNameState) ?? \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;&#x27;\u003C\u002Fspan\u003E}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eset\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003E{ set }, value\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E [firstName, lastName] = value.split(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;-&#x27;\u003C\u002Fspan\u003E);\\n        set(firstNameState, firstName);\\n        set(lastNameState, lastName);\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E UpperFullNameSelector = selector&lt;\u003Cspan class=\\\"hljs-built_in\\\"\u003Estring\u003C\u002Fspan\u003E&gt;({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;upperFullName&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003E{ get }\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E get(fullNameSelector).toUpperCase()\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Name = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E [firstName, setFirstName] = useRecoilState(firstNameState);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E [lastName, setLastName] = useRecoilState(lastNameState);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E [fullName, setFullName] = useRecoilState(fullNameSelector);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E upperFullName = useRecoilValue(UpperFullNameSelector);\\n\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EfirstName：\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Einput\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Etype\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;text&quot;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Evalue\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{firstName}\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003EonChange\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{(e)\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E setFirstName(e.target.value)} \u002F&gt;\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003ElastName：\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Einput\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Etype\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;text&quot;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Evalue\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{lastName}\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003EonChange\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{(e)\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E setLastName(e.target.value)} \u002F&gt;\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EfullName：\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Espan\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Einput\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Etype\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;text&quot;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Evalue\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{fullName}\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003EonChange\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{(e)\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E setFullName(e.target.value)} \u002F&gt;\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{upperFullName}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EName\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Ccode\u003Eselector\u003C\u002Fcode\u003E还支持异步,由于\u003Ccode\u003EReact\u003C\u002Fcode\u003E的渲染函数是同步的，所以需要\u003Ccode\u003ESuspense\u003C\u002Fcode\u003E边界包裹组件，需要捕获错误，可用\u003Ccode\u003EErrorBoundary\u003C\u002Fcode\u003E包裹,如果需要查询时传入参数，可使用\u003Ccode\u003EselectorFamily\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React, { Suspense } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { atom, RecoilRoot, selector, selectorFamily, useRecoilValue } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F const userIdState = atom({\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F     key:&#x27;userId&#x27;,\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F     default: 1\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F })\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F const userInfoSelector = selector({\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F     key:&#x27;userInfo&#x27;,\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F     get: async ({get}) =&gt; {\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F         const data = await new Promise(resolve =&gt; {\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F             setTimeout(()=&gt; resolve({id:get(userIdState),name:&#x27;用户001&#x27;}),2000)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F         })\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F         return data\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F     }\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F })\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E userInfoSelector = selectorFamily({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;userInfo&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eid\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\\n            \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E resolve({ id, \u003Cspan class=\\\"hljs-attr\\\"\u003Ename\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;用户001&#x27;\u003C\u002Fspan\u003E }), \u003Cspan class=\\\"hljs-number\\\"\u003E2000\u003C\u002Fspan\u003E);\\n        });\\n\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E AsyncSelector = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E userInfo = useRecoilValue(userInfoSelector(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E));\\n\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E用户id:{userInfo.id}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E用户名:{userInfo.name}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ESuspense\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Efallback\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{\u003C\u002Fspan\u003E&lt;\u003Cspan class=\\\"hljs-attr\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eloading...\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E}&gt;\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EAsyncSelector\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ESuspense\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E如果需要并行请求数据可以使用\u003Ccode\u003EwaitForAll\u003C\u002Fcode\u003E一次并行请求多条接口，也可以通过\u003Ccode\u003EwaiForOne\u003C\u002Fcode\u003E实现增量请求更新。\\n一般数据会在渲染之前请求获取，在\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E中可以使用\u003Ccode\u003EuseRecoilCallback\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"userecoilstate\\\"\u003EuseRecoilState()\u003C\u002Fh2\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003E对\u003Ccode\u003ERecoil state\u003C\u002Fcode\u003E读写，返回一个数组，数组第一个元素是\u003Ccode\u003Estate\u003C\u002Fcode\u003E当前值，第二个元素是设置\u003Ccode\u003Estate\u003C\u002Fcode\u003E值的函数。\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Ch2 id=\\\"userecoilvalue\\\"\u003EuseRecoilValue()\u003C\u002Fh2\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003E读取\u003Ccode\u003ERecoil state\u003C\u002Fcode\u003E的值，返回\u003Ccode\u003Estate\u003C\u002Fcode\u003E的当前值。\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Ch2 id=\\\"usesetrecoilstate\\\"\u003EuseSetRecoilState()\u003C\u002Fh2\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003E设置\u003Ccode\u003ERecoil state\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Ch2 id=\\\"useresetrecoilstate\\\"\u003EuseResetRecoilState()\u003C\u002Fh2\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003E重置\u003Ccode\u003ERecoil state\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Ch2 id=\\\"userecoilstateloadable\\\"\u003EuseRecoilStateLoadable()\u003C\u002Fh2\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003E读写异步\u003Ccode\u003Eselector\u003C\u002Fcode\u003E的值。返回一个数组，数组第一个元素是\u003Ccode\u003ELoadable\u003C\u002Fcode\u003E，第二个元素是设置的函数。使用此\u003Ccode\u003Ehooks\u003C\u002Fcode\u003E可以不使用\u003Ccode\u003ESuspense\u003C\u002Fcode\u003E来使用异步\u003Ccode\u003Eselector\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Cp\u003E\u003Ccode\u003ELoadable\u003C\u002Fcode\u003E属性：\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ccode\u003Estate\u003C\u002Fcode\u003E：\u003Ccode\u003Eselector\u003C\u002Fcode\u003E所处状态\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003EhasValue\u003C\u002Fcode\u003E：成功\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Eloading\u003C\u002Fcode\u003E：请求中\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003EhasError\u003C\u002Fcode\u003E：失败\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Econtents\u003C\u002Fcode\u003E：当前表示的值，\u003Ccode\u003EhasValue\u003C\u002Fcode\u003E状态时表示实际值，\u003Ccode\u003Eloading\u003C\u002Fcode\u003E时表示\u003Ccode\u003EPromise\u003C\u002Fcode\u003E，\u003Ccode\u003EhasError\u003C\u002Fcode\u003E时表示\u003Ccode\u003EError\u003C\u002Fcode\u003E对象\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"userecoilvalueloadable\\\"\u003EuseRecoilValueLoadable()\u003C\u002Fh2\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003E仅获取异步\u003Ccode\u003Eselector\u003C\u002Fcode\u003E的值。返回的是一个\u003Ccode\u003ELoadable\u003C\u002Fcode\u003E，同\u003Ccode\u003EuseRecoilStateLoadable\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React, { Suspense } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { RecoilRoot, selectorFamily, useRecoilValue, useRecoilValueLoadable } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E userInfoSelector = selectorFamily({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;userInfo&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eid\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\\n            \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E resolve({ id, \u003Cspan class=\\\"hljs-attr\\\"\u003Ename\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;用户001&#x27;\u003C\u002Fspan\u003E }), \u003Cspan class=\\\"hljs-number\\\"\u003E2000\u003C\u002Fspan\u003E);\\n        });\\n\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E AsyncSelector = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E userInfo = useRecoilValueLoadable(userInfoSelector(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E));\\n\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Eswitch\u003C\u002Fspan\u003E (userInfo.state) {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;hasValue&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n                \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;&gt;\u003C\u002Fspan\u003E\\n                    \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E用户id:{userInfo.contents.id}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                    \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E用户名:{userInfo.contents.name}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n            );\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E;\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;loading&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eloading...\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;hasError&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eerror\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n    }\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EAsyncSelector\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2 id=\\\"isrecoilvalue\\\"\u003EisRecoilValue()\u003C\u002Fh2\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003E是否为\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Ch2 id=\\\"atomfamily\\\"\u003EatomFamily()\u003C\u002Fh2\u003E\\n\u003Cp\u003E返回一个返回可写的\u003Ccode\u003ERecoilState atom\u003C\u002Fcode\u003E函数，用于表示一个\u003Ccode\u003Eatom\u003C\u002Fcode\u003E的集合。当你需要给\u003Ccode\u003Eatom\u003C\u002Fcode\u003E传参数时，可以使用此函数。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { atomFamily, RecoilRoot, useRecoilValue } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msgState = atomFamily({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;msg&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Edefault\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Emsg: \u003Cspan class=\\\"hljs-built_in\\\"\u003Estring\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E msg.toUpperCase()\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Msg = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msg = useRecoilValue(msgState(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;hello&#x27;\u003C\u002Fspan\u003E));\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{msg}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EMsg\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2 id=\\\"selectorfamily\\\"\u003EselectorFamily()\u003C\u002Fh2\u003E\\n\u003Cp\u003E返回一个函数，该函数返回一个只读的\u003Ccode\u003ERecoilValueReadOnly\u003C\u002Fcode\u003E或者可写的\u003Ccode\u003ERecoilState selector\u003C\u002Fcode\u003E。当你需要给\u003Ccode\u003Eselector\u003C\u002Fcode\u003E传参数时，可以使用此函数\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"constselector\\\"\u003EconstSelector()\u003C\u002Fh2\u003E\\n\u003Cp\u003E一个永远提供常量值的\u003Ccode\u003Eselector\u003C\u002Fcode\u003E。(不太清楚有什么用)\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"errorselector\\\"\u003EerrorSelector()\u003C\u002Fh2\u003E\\n\u003Cp\u003E一个总是抛出已有错误的\u003Ccode\u003Eselector\u003C\u002Fcode\u003E。(不太清楚有什么用)\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"nowait\\\"\u003EnoWait()\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ccode\u003Eselect helper\u003C\u002Fcode\u003E方法，返回值代表所提供的\u003Ccode\u003Eatom\u003C\u002Fcode\u003E 或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E当前状态的\u003Ccode\u003ELoadable\u003C\u002Fcode\u003E，与\u003Ccode\u003EuseRecoilValueLoadable()\u003C\u002Fcode\u003E类似，但\u003Ccode\u003EnoWait\u003C\u002Fcode\u003E是一个\u003Ccode\u003Eselector\u003C\u002Fcode\u003E不是钩子函数\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { noWait, RecoilRoot, selector, useRecoilValue } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msgSelector = selector({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;msgSelector&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\\n            \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E resolve(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Hello&#x27;\u003C\u002Fspan\u003E), \u003Cspan class=\\\"hljs-number\\\"\u003E2000\u003C\u002Fspan\u003E);\\n        });\\n\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Msg = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E msgLoadable = useRecoilValue(noWait(msgSelector));\\n\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E {\\n        \u003Cspan class=\\\"hljs-attr\\\"\u003EhasValue\u003C\u002Fspan\u003E: \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{msgLoadable.contents}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E,\\n        loading: \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eloading...\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E,\\n        hasError: \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eerro:{msgLoadable.contents}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    }[msgLoadable.state];\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EMsg\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2 id=\\\"waitfroall\\\"\u003EwaitFroAll()\u003C\u002Fh2\u003E\\n\u003Cp\u003E并发计算多个异步依赖项的并发\u003Ccode\u003Ehelper\u003C\u002Fcode\u003E方法，即：可用于并发请求数据。接收一个数组或者对象。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { RecoilRoot, selector, useRecoilValueLoadable, waitForAll } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E userSelector = selector({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;userSelector&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n        \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;user start&#x27;\u003C\u002Fspan\u003E);\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E resolve({ \u003Cspan class=\\\"hljs-attr\\\"\u003Eid\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-attr\\\"\u003Ename\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;codebook&#x27;\u003C\u002Fspan\u003E }), \u003Cspan class=\\\"hljs-number\\\"\u003E2000\u003C\u002Fspan\u003E)\\n        );\\n        \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;user end&#x27;\u003C\u002Fspan\u003E);\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E listSelector = selector({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;listSelector&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n        \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;list start&#x27;\u003C\u002Fspan\u003E);\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E resolve([\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-number\\\"\u003E2\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-number\\\"\u003E3\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-number\\\"\u003E4\u003C\u002Fspan\u003E]), \u003Cspan class=\\\"hljs-number\\\"\u003E2500\u003C\u002Fspan\u003E));\\n        \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;list end&#x27;\u003C\u002Fspan\u003E);\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Msg = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E { state, contents } = useRecoilValueLoadable(waitForAll([userSelector, listSelector]));\\n\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Eswitch\u003C\u002Fspan\u003E (state) {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;hasValue&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E [user, list] = contents;\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n                \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;&gt;\u003C\u002Fspan\u003E\\n                    \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E用户名：{user.name}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                    \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E列表数据：\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                    {list.map((item) =&gt; (\\n                        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{item}\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{item}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                    ))}\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n            );\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;loading&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eloading...\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;hasError&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eerror: {contents}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n    }\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EMsg\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2 id=\\\"waitforallsettled\\\"\u003EwaitForAllSettled\u003C\u002Fh2\u003E\\n\u003Cp\u003E并发计算多个异步依赖项的并发\u003Ccode\u003Ehelper\u003C\u002Fcode\u003E方法，即：可用于并发请求数据。接收一个数组或者对象。一直等待，直到有一个成功返回。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-tsx\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E React \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;react&#x27;\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E { RecoilRoot, selector, useRecoilValueLoadable, waitForAllSettled } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;recoil&#x27;\u003C\u002Fspan\u003E;\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E userSelector = selector({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;userSelector&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n        \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;user start&#x27;\u003C\u002Fspan\u003E);\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E resolve({ \u003Cspan class=\\\"hljs-attr\\\"\u003Eid\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-attr\\\"\u003Ename\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;codebook&#x27;\u003C\u002Fspan\u003E }), \u003Cspan class=\\\"hljs-number\\\"\u003E2000\u003C\u002Fspan\u003E)\\n        );\\n        \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;user end&#x27;\u003C\u002Fspan\u003E);\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E listSelector = selector({\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;listSelector&#x27;\u003C\u002Fspan\u003E,\\n    \u003Cspan class=\\\"hljs-attr\\\"\u003Eget\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Etry\u003C\u002Fspan\u003E {\\n            \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;list start&#x27;\u003C\u002Fspan\u003E);\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eresolve, reject\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-built_in\\\"\u003EsetTimeout\u003C\u002Fspan\u003E(reject, \u003Cspan class=\\\"hljs-number\\\"\u003E3000\u003C\u002Fspan\u003E));\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E data;\\n        } \u003Cspan class=\\\"hljs-keyword\\\"\u003Efinally\u003C\u002Fspan\u003E {\\n            \u003Cspan class=\\\"hljs-built_in\\\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;list end&#x27;\u003C\u002Fspan\u003E);\\n        }\\n    }\\n});\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E Msg = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E { state, contents } = useRecoilValueLoadable(\\n        waitForAllSettled([userSelector, listSelector])\\n    );\\n\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Eswitch\u003C\u002Fspan\u003E (state) {\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;hasValue&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E [{ \u003Cspan class=\\\"hljs-attr\\\"\u003Econtents\u003C\u002Fspan\u003E: user }, { \u003Cspan class=\\\"hljs-attr\\\"\u003Econtents\u003C\u002Fspan\u003E: list }] = contents; \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F =&gt; user: {id:1,name:&#x27;codebook} list: undefined\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n                \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;&gt;\u003C\u002Fspan\u003E\\n                    \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E用户名：{user.name}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                    \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E列表数据：\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                    {list?.map((item) =&gt; (\\n                        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Ekey\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E{item}\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{item}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n                    ))}\\n                \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n            );\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;loading&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eloading...\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;hasError&#x27;\u003C\u002Fspan\u003E:\\n            \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Eerror: {contents}\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\\n    }\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E App = \u003Cspan class=\\\"hljs-function\\\"\u003E() =&gt;\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E (\\n        \u003Cspan class=\\\"xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003EMsg\u003C\u002Fspan\u003E \u002F&gt;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003ERecoilRoot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    );\\n};\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Edefault\u003C\u002Fspan\u003E App;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2 id=\\\"waitfornone\\\"\u003EwaitForNone()\u003C\u002Fh2\u003E\\n\u003Cp\u003E并发计算多个异步依赖项的并发\u003Ccode\u003Ehelper\u003C\u002Fcode\u003E方法，即：可用于并发请求数据。接收一个数组或者对象。与\u003Ccode\u003EwaitForAll\u003C\u002Fcode\u003E类似，区别在于\u003Ccode\u003EwaitForNone\u003C\u002Fcode\u003E会立即为每个依赖返回一个\u003Ccode\u003ELoadable\u003C\u002Fcode\u003E，而不是直接返回值\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"waitforany\\\"\u003EwaitForAny()\u003C\u002Fh2\u003E\\n\u003Cp\u003E并发计算多个异步依赖项的并发\u003Ccode\u003Ehelper\u003C\u002Fcode\u003E方法，即：可用于并发请求数据。接收一个数组或者对象。一直等待，直到有一个成功返回\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"userecoilcallback\\\"\u003EuseRecoilCallback\u003C\u002Fh2\u003E\\n\u003Cp\u003E类似\u003Ccode\u003EuseCallback\u003C\u002Fcode\u003E,这个回调可以访问\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E状态的只读\u003Ccode\u003ESnapshot\u003C\u002Fcode\u003E，并且能够异步更新当前的\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E状态。使用场景：\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E异步读取\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E状态，而无需订阅\u003Ccode\u003EReact\u003C\u002Fcode\u003E组件在\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E更新时重新渲染\u003C\u002Fli\u003E\\n\u003Cli\u003E把昂贵的查询延迟到一个你不想在渲染时执行的异步操作\u003C\u002Fli\u003E\\n\u003Cli\u003E在你想读取 或写入\u003Ccode\u003ERecoil\u003C\u002Fcode\u003E状态的地方执行副作用\u003C\u002Fli\u003E\\n\u003Cli\u003E动态更新一个\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E，可能并不知道在渲染时要更新哪个\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E，所以不能使用\u003Ccode\u003EuseRecoilState()\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003EPre-fetching\u003C\u002Fcode\u003E渲染前的数据\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E接收参数和\u003Ccode\u003EuseCallback\u003C\u002Fcode\u003E一样，包括传入空数组只在初始化后执行一次，传入依赖项，当依赖项发生变化，重新执行。\\n\u003Cbr \u002F\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E回调函数的参数：\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ccode\u003Esnapshot\u003C\u002Fcode\u003E：\u003Ccode\u003ESnapshot\u003C\u002Fcode\u003E提供一个只读的\u003Ccode\u003ERecoil atom\u003C\u002Fcode\u003E状态\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003EgotoSnapshot\u003C\u002Fcode\u003E：更新全局状态以匹配提供的\u003Ccode\u003ESnapshot\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Eset\u003C\u002Fcode\u003E：设置\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E的值\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ccode\u003Ereset\u003C\u002Fcode\u003E：重置\u003Ccode\u003Eatom\u003C\u002Fcode\u003E或\u003Ccode\u003Eselector\u003C\u002Fcode\u003E的值\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\"}"}</script>
</div>
	</body>
</html>
