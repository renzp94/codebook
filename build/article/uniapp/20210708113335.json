{"title":"Uniapp预览pdf文件","slug":"uniapp pdf","time":"2021-07-08T11:34:01.000Z","author":"renzp94","status":"done","html":"<p>在 IOS 下其实很简单，为了兼容<code>Android</code>的话需要使用<code>pdf.js</code></p>\n<h2 id=\"下载-pdfjs\">下载 pdf.js</h2>\n<p>我将文件放到了<code>github</code>上，需要的请自行下载<a href=\"https://github.com/renzp94/uniapp-pdf.js\">uniapp-pdf.js</a>，下载成功之后将<code>hybrid</code>目录复制到项目目录的<code>static</code>下即可</p>\n<h2 id=\"开发预览页\">开发预览页</h2>\n<p>为了更好的效果，此页面使用<code>nvue</code>开发</p>\n<p><code>file-preview.nvue</code></p>\n<pre><code class=\"language-vue\"><span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">view</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">view</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;header&quot;</span> <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;{ width: `${windowWidth}px` }&quot;</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">view</span>\n                <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar&quot;</span>\n                <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;{ width: `${windowWidth}px`, marginTop: `${statusBarHeight}px` }&quot;</span>\n            &gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">image</span>\n                    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar__back&quot;</span>\n                    <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;../../static/images/arrow-left.png&quot;</span>\n                    <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;aspectFill&quot;</span>\n                    @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;goBackPage&quot;</span>\n                /&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">view</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar__title&quot;</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">text</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar__title-text&quot;</span>&gt;</span></span><span class=\"hljs-template-variable\">{{ <span class=\"hljs-name\">title</span> }}</span><span class=\"xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">text</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">view</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">image</span>\n                    <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navbar__right&quot;</span>\n                    <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;../../static/images/download.png&quot;</span>\n                    <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;aspectFill&quot;</span>\n                    @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;downloadFile(url)&quot;</span>\n                /&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">view</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">view</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">web-view</span>\n            <span class=\"hljs-attr\">:webview-styles</span>=<span class=\"hljs-string\">&quot;webviewStyles&quot;</span>\n            <span class=\"hljs-attr\">:style</span>=<span class=\"hljs-string\">&quot;{ marginTop: `${statusBarHeight + 44}px`, height: `${windowHeight}px` }&quot;</span>\n            <span class=\"hljs-attr\">:src</span>=<span class=\"hljs-string\">&quot;fullUrl&quot;</span>\n        /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">view</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n<span class=\"hljs-keyword\">import</span> { downloadFile, isAndroid } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/tools&#x27;</span>;\n<span class=\"hljs-keyword\">import</span> { goBackPage } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@/utils/pageHelper&#x27;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n    <span class=\"hljs-function\"><span class=\"hljs-title\">data</span>(<span class=\"hljs-params\"></span>)</span> {\n        <span class=\"hljs-keyword\">return</span> {\n            <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>,\n            <span class=\"hljs-attr\">fullUrl</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>,\n            <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;&#x27;</span>,\n            <span class=\"hljs-attr\">statusBarHeight</span>: <span class=\"hljs-number\">0</span>,\n            <span class=\"hljs-attr\">windowHeight</span>: <span class=\"hljs-number\">0</span>,\n            <span class=\"hljs-attr\">windowWidth</span>: <span class=\"hljs-number\">0</span>\n        };\n    },\n    <span class=\"hljs-attr\">computed</span>: {\n        <span class=\"hljs-function\"><span class=\"hljs-title\">webviewStyles</span>(<span class=\"hljs-params\"></span>)</span> {\n            <span class=\"hljs-keyword\">return</span> { <span class=\"hljs-attr\">progress</span>: { <span class=\"hljs-attr\">color</span>: <span class=\"hljs-string\">&#x27;#3C75FF&#x27;</span> } };\n        },\n        <span class=\"hljs-function\"><span class=\"hljs-title\">viewerUrl</span>(<span class=\"hljs-params\"></span>)</span> {\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&#x27;../../static/hybrid/html/web/viewer.html&#x27;</span>;\n        }\n    },\n    <span class=\"hljs-function\"><span class=\"hljs-title\">onLoad</span>(<span class=\"hljs-params\">{ url, title }</span>)</span> {\n        <span class=\"hljs-keyword\">let</span> fileUrl = url;\n        <span class=\"hljs-keyword\">if</span> (isAndroid) {\n            fileUrl = <span class=\"hljs-string\">`<span class=\"hljs-subst\">${<span class=\"hljs-built_in\">this</span>.viewerUrl}</span>?file=<span class=\"hljs-subst\">${<span class=\"hljs-built_in\">encodeURIComponent</span>(url)}</span>`</span>;\n        }\n        <span class=\"hljs-built_in\">this</span>.fullUrl = fileUrl;\n        <span class=\"hljs-built_in\">this</span>.url = url;\n        <span class=\"hljs-built_in\">this</span>.title = title ?? <span class=\"hljs-string\">&#x27;文件预览&#x27;</span>;\n        <span class=\"hljs-keyword\">const</span> { windowHeight, statusBarHeight, windowWidth } = uni.getSystemInfoSync();\n        <span class=\"hljs-built_in\">this</span>.windowHeight = windowHeight - statusBarHeight;\n        <span class=\"hljs-built_in\">this</span>.statusBarHeight = statusBarHeight;\n        <span class=\"hljs-built_in\">this</span>.windowWidth = windowWidth;\n    },\n    <span class=\"hljs-attr\">methods</span>: {\n        goBackPage,\n        downloadFile\n    }\n};\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">scoped</span>&gt;</span><span class=\"css\">\n<span class=\"hljs-selector-class\">.header</span> {\n    <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#ffffff</span>;\n    <span class=\"hljs-attribute\">position</span>: fixed;\n}\n<span class=\"hljs-selector-class\">.navbar</span> {\n    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">82</span>rpx;\n    <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">24</span>rpx;\n    <span class=\"hljs-attribute\">flex-direction</span>: row;\n    <span class=\"hljs-attribute\">align-items</span>: center;\n    <span class=\"hljs-attribute\">justify-content</span>: space-between;\n}\n<span class=\"hljs-selector-class\">.navbar__back</span> {\n    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">44</span>rpx;\n    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">44</span>rpx;\n}\n<span class=\"hljs-selector-class\">.navbar__right</span> {\n    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">56</span>rpx;\n    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">56</span>rpx;\n}\n<span class=\"hljs-selector-class\">.navbar__title</span> {\n    <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">24</span>rpx;\n    <span class=\"hljs-comment\">/* #ifdef H5 */</span>\n    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">80%</span>;\n    <span class=\"hljs-comment\">/* #endif */</span>\n    <span class=\"hljs-comment\">/* #ifdef APP-PLUS-NVUE */</span>\n    <span class=\"hljs-attribute\">flex</span>: <span class=\"hljs-number\">1</span>;\n    <span class=\"hljs-comment\">/* #endif */</span>\n}\n<span class=\"hljs-selector-class\">.navbar__title-text</span> {\n    <span class=\"hljs-comment\">/* #ifdef APP-PLUS-NVUE */</span>\n    lines: <span class=\"hljs-number\">1</span>;\n    <span class=\"hljs-comment\">/* #endif */</span>\n    <span class=\"hljs-comment\">/* #ifdef H5 */</span>\n    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;\n    <span class=\"hljs-attribute\">white-space</span>: nowrap;\n    <span class=\"hljs-comment\">/* #endif */</span>\n    <span class=\"hljs-attribute\">overflow</span>: hidden;\n    <span class=\"hljs-attribute\">text-overflow</span>: ellipsis;\n    <span class=\"hljs-attribute\">text-align</span>: center;\n}\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span></span>\n</code></pre>\n<p>其中<code>viewerUrl</code>是对应存放的<code>hybrid</code>目录的地址，在复制代码之后请自行调整正确的路径</p>\n<h2 id=\"配置预览页\">配置预览页</h2>\n<p>将预览页配置到<code>pages.json</code>，因为需要提供下载功能所以此处使用了自定义标题栏</p>\n<pre><code class=\"language-json\">{\n    <span class=\"hljs-attr\">&quot;path&quot;</span>: <span class=\"hljs-string\">&quot;pages/file-preview/index&quot;</span>,\n    <span class=\"hljs-attr\">&quot;style&quot;</span>: {\n        <span class=\"hljs-attr\">&quot;navigationBarTitleText&quot;</span>: <span class=\"hljs-string\">&quot;文件预览&quot;</span>,\n        <span class=\"hljs-attr\">&quot;navigationStyle&quot;</span>: <span class=\"hljs-string\">&quot;custom&quot;</span>\n    }\n}\n</code></pre>\n<h2 id=\"跳转预览页\">跳转预览页</h2>\n<pre><code class=\"language-js\">uni.navigate<span class=\"hljs-constructor\">To({ <span class=\"hljs-params\">url</span>: `<span class=\"hljs-operator\">/</span><span class=\"hljs-params\">pages</span><span class=\"hljs-operator\">/</span><span class=\"hljs-params\">file</span>-<span class=\"hljs-params\">preview</span><span class=\"hljs-operator\">/</span><span class=\"hljs-params\">index</span>?<span class=\"hljs-params\">url</span>=${<span class=\"hljs-params\">url</span>}&amp;<span class=\"hljs-params\">title</span>=${<span class=\"hljs-params\">title</span>}` })</span>;\n</code></pre>\n<ul>\n<li><code>url</code>：pdf 文件的地址</li>\n<li><code>title</code>：标题</li>\n</ul>\n"}