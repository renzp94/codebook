{"title":"Uniapp中常用方法封装","slug":"uniapp tools","time":"2021-07-08T11:31:08.000Z","author":"renzp94","status":"done","html":"<p>以下是在工作中可能需要用到的一些常用方法封装</p>\n<p><code>tools.js</code></p>\n<pre><code class=\"language-js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> isDev = process.env.NODE_ENV === <span class=\"hljs-string\">&#x27;development&#x27;</span>;\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> isIos = uni.getSystemInfoSync().platform === <span class=\"hljs-string\">&#x27;ios&#x27;</span>;\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> isAndroid = uni.getSystemInfoSync().platform === <span class=\"hljs-string\">&#x27;android&#x27;</span>;\n<span class=\"hljs-comment\">// 拨打电话</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> callTel = <span class=\"hljs-function\">(<span class=\"hljs-params\">tel</span>) =&gt;</span> {\n    uni.makePhoneCall({\n        <span class=\"hljs-attr\">phoneNumber</span>: tel,\n        <span class=\"hljs-attr\">fail</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>) =&gt;</span> {\n            uni.showToast({\n                <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;拨打失败，请稍后重试&#x27;</span>,\n                <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span>\n            });\n        }\n    });\n};\n<span class=\"hljs-comment\">// 下载文件</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> downloadFile = <span class=\"hljs-function\">(<span class=\"hljs-params\">url</span>) =&gt;</span> {\n    uni.showLoading({\n        <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存中...&#x27;</span>\n    });\n    uni.downloadFile({\n        url,\n        <span class=\"hljs-attr\">success</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> {\n            <span class=\"hljs-keyword\">if</span> (data.statusCode === <span class=\"hljs-number\">200</span>) {\n                uni.saveFile({\n                    <span class=\"hljs-attr\">tempFilePath</span>: data.tempFilePath,\n                    <span class=\"hljs-function\"><span class=\"hljs-title\">success</span>(<span class=\"hljs-params\">res</span>)</span> {\n                        uni.showToast({\n                            <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span>,\n                            <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存成功&#x27;</span>\n                        });\n                    },\n                    <span class=\"hljs-function\"><span class=\"hljs-title\">fail</span>(<span class=\"hljs-params\"></span>)</span> {\n                        uni.showToast({\n                            <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存失败，请稍后重试&#x27;</span>,\n                            <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span>,\n                            <span class=\"hljs-attr\">duration</span>: <span class=\"hljs-number\">3000</span>\n                        });\n                    }\n                });\n            } <span class=\"hljs-keyword\">else</span> {\n                uni.showToast({\n                    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存失败，请稍后重试&#x27;</span>,\n                    <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span>\n                });\n            }\n        }\n    });\n};\n<span class=\"hljs-comment\">// 预览图片</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> previewImage = <span class=\"hljs-function\">(<span class=\"hljs-params\">urls, current = <span class=\"hljs-number\">1</span></span>) =&gt;</span> {\n    uni.previewImage({\n        current,\n        urls\n    });\n};\n<span class=\"hljs-comment\">// 保存图片</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> saveImage = <span class=\"hljs-function\">(<span class=\"hljs-params\">url</span>) =&gt;</span> {\n    uni.showLoading({\n        <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存中...&#x27;</span>\n    });\n    uni.downloadFile({\n        url,\n        <span class=\"hljs-attr\">success</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> {\n            <span class=\"hljs-keyword\">if</span> (data.statusCode === <span class=\"hljs-number\">200</span>) {\n                uni.saveImageToPhotosAlbum({\n                    <span class=\"hljs-attr\">filePath</span>: data.tempFilePath,\n                    <span class=\"hljs-function\"><span class=\"hljs-title\">success</span>(<span class=\"hljs-params\">res</span>)</span> {\n                        uni.showToast({\n                            <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span>,\n                            <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存成功&#x27;</span>\n                        });\n                    },\n                    <span class=\"hljs-function\"><span class=\"hljs-title\">fail</span>(<span class=\"hljs-params\">err</span>)</span> {\n                        <span class=\"hljs-built_in\">console</span>.log(err);\n                        uni.showToast({\n                            <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存失败，请稍后重试&#x27;</span>,\n                            <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span>,\n                            <span class=\"hljs-attr\">duration</span>: <span class=\"hljs-number\">3000</span>\n                        });\n                    }\n                });\n            } <span class=\"hljs-keyword\">else</span> {\n                uni.showToast({\n                    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;保存失败，请稍后重试&#x27;</span>,\n                    <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span>\n                });\n            }\n        }\n    });\n};\n<span class=\"hljs-comment\">// 通过浏览器打开外链</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> openLink = <span class=\"hljs-function\">(<span class=\"hljs-params\">url</span>) =&gt;</span> {\n    <span class=\"hljs-comment\">// #ifdef APP-PLUS</span>\n    plus.runtime.openURL(<span class=\"hljs-built_in\">encodeURI</span>(url));\n    <span class=\"hljs-comment\">// #endif</span>\n    <span class=\"hljs-comment\">// #ifndef APP-PLUS</span>\n    uni.showToast({ <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">&#x27;仅App内支持操作&#x27;</span>, <span class=\"hljs-attr\">icon</span>: <span class=\"hljs-string\">&#x27;none&#x27;</span> });\n    <span class=\"hljs-comment\">// #endif</span>\n};\n</code></pre>\n"}